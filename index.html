<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Australian Workplace Injuries and Fatalities</title>
  <link href="https://fonts.googleapis.com/css2?family=Manrope:wght@400;600;700&display=swap" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/vega@5"></script>
  <script src="https://cdn.jsdelivr.net/npm/vega-lite@5"></script>
  <script src="https://cdn.jsdelivr.net/npm/vega-embed@7"></script>

  <style>
    body {
      font-family: 'Manrope', sans-serif;
      margin: 0;
      padding: 0;
      background-color: #f9fafb;
      color: #222;
    }

    .title-box {
      background-color: #ffffff;
      margin: 40px auto 30px auto;
      padding: 30px;
      border-radius: 10px;
      max-width: 1080px;
      text-align: center;
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.08);
    }

    h1 {
      margin: 0;
      font-size: 2rem;
      color: #1c2a36;
    }

    .title-box p {
      color: #5c6670;
      margin-top: 10px;
      font-size: 1.1rem;
    }

    .box {
      background-color: #ffffff;
      margin: 25px auto;
      padding: 30px;
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.08);
      border-radius: 10px;
      max-width: 1080px;
      transition: box-shadow 0.3s ease;
    }

    .box:hover {
      box-shadow: 0 6px 20px rgba(0, 0, 0, 0.12);
    }

    .split {
      display: flex;
      gap: 30px;
      flex-wrap: wrap;
    }

    .left, .right {
      display: flex;
      flex-direction: column;
      gap: 25px;
      flex: 1;
    }

    .chart-placeholder {
      background-color: #ffffff;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 8px;
      font-weight: 600;
      color: #555;
      min-height: 300px;
      width: 100%;
      border: 1px dashed #cfd6df;
      transition: background-color 0.3s ease, border-color 0.3s ease;
    }

    .text-placeholder {
      padding: 10px 15px;
      color: #374151;
    }

    .text-placeholder h3 {
      color: #1e2a33;
      margin-bottom: 8px;
    }

    .text-placeholder p {
      color: #4b5563;
      line-height: 1.6;
      font-size: 14px;
    }

    .legend {
      display: flex;
      justify-content: center;
      gap: 20px;
      margin-top: 2px;
    }

    .legend-item {
      display: flex;
      align-items: center;
      gap: 6px;
      font-family: 'Manrope', sans-serif;
      font-size: 13px;
      color: #333;
    }

    .legend-color {
      width: 8px;
      height: 8px;
      border-radius: 3px;
      display: inline-block;
    }

    .info-box {
      background-color: #ffffff;
      margin: 25px auto;
      padding: 25px 30px;
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.08);
      border-radius: 10px;
      max-width: 1080px;
      font-size: 11px;
      color: #374151;
      line-height: 1.6;
    }

    body {
      font-family: 'Manrope', sans-serif;
      margin: 0;
      padding: 0;
      background: linear-gradient(to bottom, #cfe8ff 0%, #f9fafb 100%);
      color: #222;
      background-attachment: fixed;
    }

    .vega-bind select {
      font-size: 12px;
      padding: 5px 10px;
    }

    .vega-bind label {
      font-size: 12px;
    }


    @media (max-width: 1100px) {
      .split {
        flex-direction: column;
      }
    }
  </style>
</head>

<body>
  <!-- Title -->
  <div class="title-box">
    <h1>Australian Workplace Injuries and Fatalities</h1>
  </div>

  <!-- Box 1: Line Chart Injuries vs Fatalities -->
  <div class="box split">
    <div class="left" style="flex:3;">
      <div id="chart1" class="chart-placeholder"></div>
        <div class="legend">
          <div class="legend-item">
            <span class="legend-color" style="background-color: darkblue;"></span>
            <span class="legend-text">Injuries</span>
          </div>
          <div class="legend-item">
            <span class="legend-color" style="background-color: darkred;"></span>
            <span class="legend-text">Fatalities</span>
          </div>
</div>
    </div>
    <div class="right" style="flex:2;">
      <div class="text-placeholder">
        <h3>Injuries and Fatalities Over the Years</h3>
        <p>Despite our current workplace safety practices and laws, 
          workplace <strong style="color: #00008b;">injuries</strong> and <strong style="color: #8b0000;">fataltiies</strong> are still a prominent risk that workers have to face each day. 
          The line chart on the left shows the steady trend of increasing injuries and fatalities in Australian workforces from 2018-2022. 
        </p>
        <p>
          This trend is alarming, and highlights the need for greater analysis into our workforces to allow for safer working environments 
          for everyone. In this visualisation, we aim to uncover more insights into how these injuries occur, where these occur
          and who's most at risk to help prompt greater safety measures and policy changes in these areas.
        </p>
          
      </div>
    </div>
  </div>

  <!-- Box 2 Mechanism and Bodily Location-->
  <div class="box split" style="align-items: stretch; height: 700;">
    <!-- Left column: text on top, chart2 below -->
    <div class="left" style="flex:2; gap: 20px;">
      <div class="text-placeholder" style="flex: 1;">
        <h3>How and Where Are People Getting Injured?</h3>
        <p>Firstly, we examine the most common methods of injuries and at which bodily region workers are injured the most.
        </p>
        
        <p>
          From the bar chart below, we can see that <strong style="color: #1e8449;">Falls</strong> dominate as the the highest method of injury, followed by being <strong style="color: #3a4991;">Hit By A Moving Object</strong>. 
          The chart on the right highlights which regions workers are most likely to face injuries. We can see that <strong style="color: rgb(29, 27, 27);">Hand and Wrist, and Back </strong>injuries are most prevalent.
        </p>

        <p>
            This signals the need for improved protective gear, such as gloves, and greater emphasis on training to help workers avoid straining their bodies. Programs could include proper lifting techniques, and
            and strategies to reduce physical stress to help prevent common injuries to the hands and back.
        </p>

      </div>
      <div id="chart2" class="chart-placeholder" style="flex: 2; "></div>
    </div>

    <!-- Right column: chart3 -->
    <div class="right" style="flex:3;">
      <div id="chart3" class="chart-placeholder" style="flex:1; "></div>
    </div>
  </div>
  
  <!-- Box 3 Injuries and Fatalities by Industry and State-->
  <div class="box split">
    <div class="left" style="flex:3;">
      <div id="chart4" class="chart-placeholder" style="min-height: 500px;"></div>
    </div>
    <div class="right" style="flex:2;">
      <div class="text-placeholder">
        <h3>Injuries and Fatalities by Industry and State</h3>
        <p>Now we compare workplace injury and fatality rates across Victorian local government areas and workplace industries to identify high-risk sectors.  Use the year filter to explore how these figures have changed from 2018 to 2022.</p>

        <hr style="border: 0; border-top: 1px solid #ccc;">
        
        <h5>Industry Focus</h5>
        <p>The dual pie chart illustrates the contrast between the number of injuries and fatalities across industries. On average, <strong style="color: #3a4991;">Health Care and Social Assistance</strong> records the highest number of injuries, 
          while <strong style="color: #9bbb59;">Construction</strong> experiences the greatest number of workplace fatalities from 2018 to 2022.</p>
        
        <hr style="border: 0; border-top: 1px solid #ccc">

        <h5>State Focus</h5>
        <p>The map chart highlights the states with the highest fatality rates per population.</p>

      <p>Overall, we can see that regional areas, particularly states farther from Melbourne, 
        have higher fatality rates, likely due to a greater concentration of factories and construction zones. 
        This highlights the need for stronger workplace safety regulations, not only in central areas but 
        also with a greater focus on regional safety.</p>
      </div>
    </div>
  </div>

  <!-- Box 4 Gender Claims vs Fatalities -->
  <div class="box split">
    <div class="left">
      <div id="chart5" class="chart-placeholder"></div>
    </div>
    <div class="right">
      <div class="text-placeholder">
        <h3>The Gender Gap</h3>
        <p>Now we’ll explore the gender differences in workplace injury and fatality rates.
        The chart to the right highlights these differences, and you can use the filter to switch
        between viewing the number of injuries versus the number of fatalities.</p>
        <p>When switching between the views, we can see that <strong style="color: #1f77b4;">Males</strong> consistently have higher numbers of both injuries and fatalities, with older males (aged 55–64) being most at risk.</p>
        <p>This trend likely reflects the higher safety risks in male-dominated industries such as construction, which we outlined earlier as the industry with the highest number of workplace fatalities.</p>
      </div>
    </div>
  </div>

  <!-- Box 5 Reasons for stopping work -->
  <div class="box split">
    <div class="left" style="flex:2;">
      <div class="text-placeholder">
        <h3>What Happens After the Injury?</h3>
        <p>The chart to the right shows what happens after an injury. Use the filter to view the decision workers make and their proportions. More women cease working entirely, while more men are laid off. Among those who stay in the workforce, 
          <strong style="color: black;">88% of men</strong> to work compared to <strong style="color: black;">80% of women</strong>, showing differences in recovery and support.</p>
        
        <hr style="border: 0; border-top: 1px solid #ccc;">

        <h3>What Needs to Be Done?</h3>
        <p>In summary, the key trends from this visualisation show that falls and back or hand injuries are common, with construction and health care carrying the highest risks. Males are more affected, highlighting the real human cost behind these numbers. 
          Reducing these injuries will require stronger safety protocols, better protective gear, and targeted training in high-risk industries. </p>

        <p>Overall, we've outlined key actionable improvements, and we hope these insights help create workplaces where no one has to fear for their safety while earning a living.</p>

      </div>
    </div>
    <div class="right" style="flex:3;">
      <div id="chart6" class="chart-placeholder"></div>
    </div>
  </div>

  <!-- Box 6 Details -->
  <div class="info-box">
    <h3>About this Visualisation</h3>
    <p><strong>Author:</strong> Li Jing Tan<strong>
    <p>Date:</strong> 19 October 2025</p>
    <p><strong>Data Sources:</strong></p>
    <p>Safe Work Australia (2018-2022)</p>
    <p>Australian Bureau Of Statsitics (ABS)</p>
  </div>
  

  <script>
    const spec1 = {
      "$schema": "https://vega.github.io/schema/vega-lite/v6.json",
      "title": "Number of Workplace Injuries and Fatalities (2018-2022)",
      "description": "Dual-axis line chart of Injuries and Fatalities with trend lines, tooltips, and annotation",
      "width": 600,
      "height": 400,
      "data": {
        "url": "https://raw.githubusercontent.com/ltan0120/Final-3179/main/Chart%201%20-%20Number%20of%20Injuries%20and%20Fatalities.csv"
      },
      "layer": [
        {
          "layer": [
            {
              "mark": {"type": "line", "point": true},
              "encoding": {
                "x": {"field": "Year", "type": "ordinal", "title": "", "axis": {"labelAngle": 0}},
                "y": {"field": "Count", "type": "quantitative", "title": "Count of Injuries", "axis": {"format": ",", "labelExpr": "datum.value"}, "scale": {"domain": [0, 45000]}},
                "color": {"value": "darkblue"},
                "tooltip": [
                  {"field": "Event", "type": "nominal"},
                  {"field": "Year", "type": "ordinal"},
                  {"field": "Count", "type": "quantitative", "format": ","}
                ]
              },
              "transform": [{"filter": "datum.Event == 'Injuries'"}]
            },
            {
              "mark": {"type": "line", "strokeDash": [4,4]},
              "encoding": {
                "x": {"field": "Year", "type": "ordinal"},
                "y": {"field": "Count", "type": "quantitative", "scale": {"domain": [0, 45000]}},
                "color": {"value": "darkblue"}
              },
              "transform": [
                {"filter": "datum.Event == 'Injuries'"},
                {"regression": "Count", "on": "Year"}
              ]
            }
          ]
        },
        {
          "layer": [
            {
              "mark": {"type": "line", "point": true},
              "encoding": {
                "x": {"field": "Year", "type": "ordinal", "axis": {"labelAngle": 0}},
                "y": {"field": "Count", "type": "quantitative", "title": "Count of Fatalities", "axis": {"orient": "right", "format": ",", "labelExpr": "datum.value"}, "scale": {"domain": [0,100]}},
                "color": {"value": "darkred"},
                "tooltip": [
                  {"field": "Event", "type": "nominal"},
                  {"field": "Year", "type": "ordinal"},
                  {"field": "Count", "type": "quantitative", "format": ","}
                ]
              },
              "transform": [{"filter": "datum.Event == 'Fatalities'"}]
            },
            {
              "mark": {"type": "line", "strokeDash": [4,4]},
              "encoding": {
                "x": {"field": "Year", "type": "ordinal"},
                "y": {"field": "Count", "type": "quantitative", "scale": {"domain": [0,100]}},
                "color": {"value": "darkred"}
              },
              "transform": [
                {"filter": "datum.Event == 'Fatalities'"},
                {"regression": "Count", "on": "Year"}
              ]
            }
          ]
        },
        {
          "layer": [
            {
              "data": {"values": [{"Year": "2020", "ymin": 0, "ymax": 35000}]},
              "mark": {"type": "rule", "strokeDash": [2,2], "color": "black"},
              "encoding": {"x": {"field": "Year", "type": "ordinal"}, "y": {"field": "ymin", "type": "quantitative", "axis": null}, "y2": {"field": "ymax"}}
            },
            {
              "data": {"values": [{"Year": "2020", "Count": 34000, "text": "Covid lowered in-person work"}]},
              "mark": {"type": "text", "angle": 0, "dy": 270, "dx": 90, "fontWeight": "bold"},
              "encoding": {"x": {"field": "Year", "type": "ordinal"}, "y": {"field": "Count", "type": "quantitative"}, "text": {"field": "text"}}
            },
            {
              "data": {"values": [{"Year": "2020", "Count": 34000, "text": "and thus the number of injuries"}]},
              "mark": {"type": "text", "angle": 0, "dy": 290, "dx": 95, "fontWeight": "bold"},
              "encoding": {"x": {"field": "Year", "type": "ordinal"}, "y": {"field": "Count", "type": "quantitative"}, "text": {"field": "text"}}
            }
          ]
        }
      ],
      "resolve": {"scale": {"y": "independent"}},
      "config": {"background": "white", "axis": {"labelColor": "#333", "titleColor": "#333"}, "font": "Manrope"}
    };

    const spec2 = {
      "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
      "title": "Methods of Injury",
      "width": 350,
      "height": 250,
      "data": {
        "url": "https://raw.githubusercontent.com/ltan0120/Final-3179/main/Chart%202%20-%20Mechanism%20of%20Injury%20Stacked%20Bar.csv"
      },
      "mark": {
        "type": "bar",
        "tooltip": true
      },
      "encoding": {
        "x": {
          "field": "Year",
          "type": "ordinal",
          "axis": {"title": "Year", "labelAngle": 0}
        },
        "xOffset": {
          "field": "Mechanism of Injury",
          "type": "nominal",
          "sort": ["Falls", "Hit By Moving Object", "Vehicle Accidents", "Chemicals", "Heat or Electricity"]
        },
        "y": {
          "field": "Count",
          "type": "quantitative",
          "axis": {"title": "Number of Injuries"}
        },
        "color": {
          "field": "Mechanism of Injury",
          "type": "nominal",
          "scale": {
            "domain": ["Falls", "Hit By Moving Object", "Vehicle Accidents", "Chemicals", "Heat or Electricity"],
            "range": ["#1e8449", "#3a4991", "#f5b73b", "#fa1b35", "#809191"] 
          },
          "legend": {"title": "Method of Injury"}
        },
        "tooltip": [
          {"field": "Year", "type": "ordinal", "title": "Year"},
          {"field": "Mechanism of Injury", "type": "nominal", "title": "Method"},
          {"field": "Count", "type": "quantitative", "title": "Number of Injuries", "format": ","}
        ]
      },
      "config": {
        "bar": {"binSpacing": 10},
        "background": "white",
        "axis": {"labelColor": "#333", "titleColor": "#333"},
        "font": "Manrope"
      }
    };

    const spec3 = {
      "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
      "title": {
        "text": "Proportion of Injuries Per Bodily Region (2022)",
        "font": "Manrope",
        "fontSize": 13,
        "dy": 40
      },
      "width": 450,
      "height": 500,


      "layer": [
        // Background human image
        {
          "data": {"values": [{"x": 500, "y": 0}]},
          "mark": {
            "type": "image",
            "url": "https://raw.githubusercontent.com/ltan0120/Final-3179/main/Your%20paragraph%20text%20(1250%20x%206300%20px)%20(1400%20x%202000%20px).png",
            "width": 493,
            "height": 650,
            "xOffset": -245,
            "yOffset": -235
          },
          "encoding": {
            "x": {"field": "x", "type": "quantitative", "scale": {"domain": [0,455]}},
            "y": {"field": "y", "type": "quantitative", "scale": {"domain": [0,525]}}
          }
        },
        // Injury data
        {
          "data": {
            "url": "https://raw.githubusercontent.com/ltan0120/Final-3179/main/Chart%203%20-%20Injury%20Bodily%20Location.csv"
          },
          "transform": [
            {"filter": "datum.Year == 2022"},
            {"calculate": "replace(datum['% of Year Total'], '%', '')", "as": "PercentageValue"},
            {"calculate": "datum['PercentageValue'] + '%'", "as": "DisplayPercentage"},
            // Scale x positions
            {"calculate": "(datum['Body Location'] == 'Cranium' ? 243 : datum['Body Location'] == 'Neck' ? 620 : datum['Body Location'] == 'Shoulder' ? 147 : datum['Body Location'] == 'Back - Upper Or Lower' ? 670 : datum['Body Location'] == 'Hand And Wrist' ? 180 : datum['Body Location'] == 'Knee' ? 645 : datum['Body Location'] == 'Foot And Ankle' ? 250 : 0) * 0.65", "as": "x"},
            // Scale y positions
            {"calculate": "(datum['Body Location'] == 'Cranium' ? 805 : datum['Body Location'] == 'Neck' ? 694 : datum['Body Location'] == 'Shoulder' ? 637 : datum['Body Location'] == 'Back - Upper Or Lower' ? 545 : datum['Body Location'] == 'Hand And Wrist' ? 396 : datum['Body Location'] == 'Knee' ? 219 : datum['Body Location'] == 'Foot And Ankle' ? 50 : 0) * 0.65625", "as": "y"}
          ],
          "mark": {
            "type": "text",
            "font": "Manrope",
            "fontSize": 12,
            "color": "#8b0000",
            "fontWeight": "bold"
          },
          "encoding": {
            "x": {"field": "x", "type": "quantitative"},
            "y": {"field": "y", "type": "quantitative"},
            "text": {"field": "DisplayPercentage"},
            "tooltip": [
              {"field": "Body Location", "title": "Body Part"},
              {"field": "DisplayPercentage", "title": "% of Total Yearly Injuries"}
            ]
          }
        }
      ]
    }

    const spec4 = {
      "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
      "title": "",
      "background": "#ffffff",
      "config": {
        "font": "Manrope",
        "axis": {"labelColor": "#333", "titleColor": "#333"}
      },
      "params": [
        {
          "name": "year_selection",
          "value": 2018,
          "bind": {
            "input": "select",
            "options": [2018, 2019, 2020, 2021, 2022],
            "name": "Select Year: "
          }
        }
      ],
      "vconcat": [
        {
          "hconcat": [
            {
              "title": "Injuries per Industry",
              "width": 350,
              "height": 250,
              "layer": [
                {
                  "data": {
                    "url": "https://raw.githubusercontent.com/ltan0120/Final-3179/main/Chart%204%20-%20Workplace%20Claims%20and%20Fatalities%20Per%20Industry.csv"
                  },
                  "transform": [
                    {"filter": "datum.Year == year_selection"},
                    {"filter": "datum.Type == 'Workplace Claims'"},
                    {"aggregate": [{"op": "sum", "field": "Total Count", "as": "TotalValue"}], "groupby": ["Industry"]},
                    {"joinaggregate": [{"op": "sum", "field": "TotalValue", "as": "TotalAll"}]},
                    {"calculate": "datum.TotalValue / datum.TotalAll", "as": "Percentage"}
                  ],
                  "mark": {"type": "arc", "outerRadius": 150, "innerRadius": 100},
                  "encoding": {
                    "theta": {"field": "Percentage", "type": "quantitative"},
                    "color": {
                      "field": "Industry",
                      "type": "nominal",
                      "scale": {"range": ["#9bbb59","#f79646","#3a4991","#3b304d","#7f7f7f","#809191","#4bacc6","#4f81bd","#8064a2"]},
                      "legend": {
                        "orient": "bottom",
                        "title": null,
                        "columns": 4,
                        "symbolSize": 80,
                        "labelFontSize": 10,
                        "padding": 20
                      }
                    },
                    "tooltip": [
                      {"field": "Industry"},
                      {"field": "TotalValue", "title": "Total Claims", "format": ","},
                      {"field": "Percentage", "title": "% of Total", "format": ".1%"}
                    ]
                  }
                },
                {
                  "data": {
                    "url": "https://raw.githubusercontent.com/ltan0120/Final-3179/main/Chart%204%20-%20Workplace%20Claims%20and%20Fatalities%20Per%20Industry.csv"
                  },
                  "transform": [
                    {"filter": "datum.Year == year_selection"},
                    {"filter": "datum.Type == 'Workplace Claims'"},
                    {"aggregate": [{"op": "sum", "field": "Total Count", "as": "TotalValue"}], "groupby": ["Industry"]},
                    {"window": [{"op": "rank", "as": "rank"}], "sort": [{"field": "TotalValue", "order": "descending"}]},
                    {"filter": "datum.rank == 1"}
                  ],
                  "mark": {"type": "text", "x": 175, "y": 110, "align": "center", "fontSize": 11, "fontWeight": "bold"},
                  "encoding": {"text": {"field": "Industry", "type": "nominal"}}
                },
                {
                  "data": {"values": [{}]},
                  "mark": {"type": "text", "x": 175, "y": 125, "align": "center", "fontSize": 10},
                  "encoding": {"text": {"value": "with highest number of injuries"}}
                }
              ],
              "view": {"stroke": null}
            },
            {
              "title": "Fatalities per Industry",
              "width": 350,
              "height": 250,
              "layer": [
                {
                  "data": {
                    "url": "https://raw.githubusercontent.com/ltan0120/Final-3179/main/Chart%204%20-%20Workplace%20Claims%20and%20Fatalities%20Per%20Industry.csv"
                  },
                  "transform": [
                    {"filter": "datum.Year == year_selection"},
                    {"filter": "datum.Type == 'Workplace Fatalities'"},
                    {"aggregate": [{"op": "sum", "field": "Total Count", "as": "TotalValue"}], "groupby": ["Industry"]},
                    {"joinaggregate": [{"op": "sum", "field": "TotalValue", "as": "TotalAll"}]},
                    {"calculate": "datum.TotalValue / datum.TotalAll", "as": "Percentage"}
                  ],
                  "mark": {"type": "arc", "outerRadius": 150, "innerRadius": 100},
                  "encoding": {
                    "theta": {"field": "Percentage", "type": "quantitative"},
                    "color": {"field": "Industry", "type": "nominal", "scale": {"range": ["#9bbb59","#f79646","#3a4991","#3b304d","#7f7f7f","#809191","#4bacc6","#4f81bd","#8064a2"]}},
                    "tooltip": [
                      {"field": "Industry"},
                      {"field": "TotalValue", "title": "Total Fatalities", "format": ","},
                      {"field": "Percentage", "title": "% of Total", "format": ".1%"}
                    ]
                  }
                },
                {
                  "data": {
                    "url": "https://raw.githubusercontent.com/ltan0120/Final-3179/main/Chart%204%20-%20Workplace%20Claims%20and%20Fatalities%20Per%20Industry.csv"
                  },
                  "transform": [
                    {"filter": "datum.Year == year_selection"},
                    {"filter": "datum.Type == 'Workplace Fatalities'"},
                    {"aggregate": [{"op": "sum", "field": "Total Count", "as": "TotalValue"}], "groupby": ["Industry"]},
                    {"window": [{"op": "rank", "as": "rank"}], "sort": [{"field": "TotalValue", "order": "descending"}]},
                    {"filter": "datum.rank == 1"}
                  ],
                  "mark": {"type": "text", "x": 175, "y": 110, "align": "center", "fontSize": 11, "fontWeight": "bold"},
                  "encoding": {"text": {"field": "Industry", "type": "nominal"}}
                },
                {
                  "data": {"values": [{}]},
                  "mark": {"type": "text", "x": 175, "y": 125, "align": "center", "fontSize": 10},
                  "encoding": {"text": {"value": "with highest number of Fatalities"}}
                }
              ],
              "view": {"stroke": null}
            }
          ],
          "title": {"text": "Injuries and Fatalities Per Industry", "anchor": "middle", "fontSize": 16, "fontWeight": "bold", "dy": -20}
        },
        {
          "vconcat": [
            {
              "title": {"text": "Workplace Fatalities per Victorian Local Government Area", "fontSize": 16, "fontWeight": "bold", "anchor": "middle", "dy": -10, "dx": 50},
              "width": 580,
              "height": 400,
              "view": {"stroke": null, "fill": "#cfe8ff"},
              "projection": {"type": "mercator", "center": [145.8, -36.7], "scale": 3200, "translate": [300, 200]},
              "layer": [
                {"data": {"graticule": {"step": [2,2]}}, "mark": {"type": "geoshape", "stroke": "gray", "strokeWidth": 0.2}},
                {"data": {"url": "https://raw.githubusercontent.com/ltan0120/Final-3179/main/mapshaperoutput2.json", "format": {"type": "topojson", "feature": "LGA_POLYGON"}}, "mark": {"type": "geoshape", "fill": "white", "stroke": "black", "strokeWidth": 0.5}},
                {
                  "data": {"url": "https://raw.githubusercontent.com/ltan0120/Final-3179/main/Chart%205%20-%20Workplace%20Fatalities%20Per%20State.csv"},
                  "transform": [
                    {"filter": "datum.Year == year_selection"},
                    {"calculate": "toNumber(datum['DeathsPer100k'])", "as": "DeathsPer100k"},
                    {
                      "lookup": "LGA",
                      "from": {"data": {"url": "https://raw.githubusercontent.com/ltan0120/Final-3179/main/mapshaperoutput2.json", "format": {"type": "topojson", "feature": "LGA_POLYGON"}}, "key": "properties.LGA_NAME", "fields": ["geometry"]},
                      "as": ["geo"]
                    }
                  ],
                  "mark": {"type": "geoshape", "stroke": "black", "strokeWidth": 0.5},
                  "encoding": {
                    "shape": {"field": "geo", "type": "geojson"},
                    "color": {
                      "field": "DeathsPer100k",
                      "type": "quantitative",
                      "scale": {"domain": [2,5,7.5,10,15,20,25], "range": ["#fcae91","#fb6a4a","#ef3b2c","#cb181d","#99000d","#69030b"]},
                      "legend": {"title": "Fatalities per 100,000", "orient": "right"},
                      "condition": {"test": "!isValid(datum.DeathsPer100k)", "value": "#FFFFFF"}
                    },
                    "tooltip": [
                      {"field": "LGA", "title": "Local Government Area"},
                      {"field": "DeathsPer100k", "title": "Fatalities per 100k Individuals", "format": ".2f"},
                      {"field": "Population", "title": "Population", "format": ","},
                      {"field": "Year", "title": "Year"}
                    ]
                  }
                },
                {
                  "data": {"url": "https://raw.githubusercontent.com/ltan0120/Final-3179/main/Chart%205%20-%20Workplace%20Fatalities%20Per%20State.csv"},
                  "transform": [
                    {"filter": "datum.Year == year_selection"},
                    {"calculate": "toNumber(datum['DeathsPer100k'])", "as": "DeathsPer100k"},
                    {"window": [{"op": "rank", "as": "rank"}], "sort": [{"field": "DeathsPer100k", "order": "descending"}]},
                    {"filter": "datum.rank == 1"},
                    {"calculate": "datum['LGA'] + ' with highest fatality rate per 100,000 individuals: ' + format(datum['DeathsPer100k'], '.2f')", "as": "label"}
                  ],
                  "mark": {"type": "text", "x": 379, "y": 90, "align": "center", "fontSize": 11, "fontWeight": "bold", "color": "black"},
                  "encoding": {"text": {"field": "label"}}
                }
              ]
            },
            {
              "data": {"values": [{}]},
              "mark": {"type": "text", "x": 350, "y": 10, "align": "center", "fontSize": 10, "fontStyle": "italic", "color": "#333"},
              "encoding": {"text": {"value": "NOTE: Local Government Areas coloured in white have no data"}}
            }
          ], 
        }
      ]
    };

    const spec5 = {
        "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
        "title": {
          "text": "Workplace Injuries vs Fatalities by Gender and Age Group (2018-2022)",
          "anchor": "middle",
          "fontWeight": "bold"
        },
        "config": {
          "font": "Manrope",
          "axis": {"labelColor": "#333", "titleColor": "#333"},
        },
        "width": 500,
        "data": {
          "url": "https://raw.githubusercontent.com/ltan0120/Final-3179/main/Chart%206%20-%20Gender%20Split%20Fatalities%20vs%20Claims.csv"
        },
        "params": [
          {
            "name": "selected_measure",
            "value": "Workplace Claims",
            "bind": {
              "input": "select",
              "options": ["Workplace Claims", "Workplace Fatalities"],
              "labels": ["Number of Injuries", "Number of Fatalities"],
              "name": "Select Measure: "
            }
          }
        ],
        "vconcat": [
          {
            "layer": [
              {
                "mark": {"type": "image", "width": 50, "height": 50},
                "encoding": {
                  "x": {"value": 140},
                  "y": {"value": 35},
                  "url": {"value": "https://raw.githubusercontent.com/ltan0120/Final-3179/main/female%20icon.png"}
                }
              },
              {
                "mark": {"type": "text", "text": "Female", "align": "center", "fontWeight": "bold"},
                "encoding": {
                  "x": {"value": 140},
                  "y": {"value": 95},
                  "color": {"value": "#e377c2"}
                }
              },
              {
                "mark": {"type": "image", "width": 50, "height": 50},
                "encoding": {
                  "x": {"value": 440},
                  "y": {"value": 35},
                  "url": {"value": "https://raw.githubusercontent.com/ltan0120/Final-3179/main/male%20icon.png"}
                }
              },
              {
                "mark": {"type": "text", "text": "Male", "align": "center", "fontWeight": "bold"},
                "encoding": {
                  "x": {"value": 440},
                  "y": {"value": 95},
                  "color": {"value": "#1f77b4"}
                }
              }
            ],
          },
          {
            "hconcat": [
              {
                "width": 240,
                "transform": [
                  {"filter": "datum.Gender == 'Female'"},
                  {"filter": "datum.Value == selected_measure"},
                  {"calculate": "-datum['Total']", "as": "mirrored_total"},
                  {
                    "calculate": "selected_measure == 'Workplace Claims' ? 'Number of Injuries' : 'Number of Fatalities'",
                    "as": "Measure"
                  }
                ],
                "layer": [
                  {
                    "mark": {"type": "bar", "size": 19},
                    "encoding": {
                      "y": {
                        "field": "Age",
                        "type": "ordinal",
                        "sort": ["15 - 24","25 - 34","35 - 44","45 - 54","55 - 64","65+"],
                        "axis": null
                      },
                      "x": {
                        "aggregate": "sum",
                        "field": "mirrored_total",
                        "title": {"expr": "selected_measure"},
                        "scale": {
                          "domain": {
                            "expr": "selected_measure == 'Workplace Claims' ? [-22000, 0] : [-85, 0]"
                          }
                        },
                        "axis": {
                          "format": "d",
                          "labelExpr": "abs(datum.value)",
                          "tickCount": 5
                        }
                      },
                      "color": {
                        "field": "Gender",
                        "scale": {"range": ["#e377c2", "#1f77b4"]},
                        "legend": null
                      },
                      "tooltip": [
                        {"field": "Gender"},
                        {"field": "Measure"},
                        {"field": "Age", "title": "Age Group"},
                        {"field": "Total", "title": "Total", "format": ","},
                      ],
                    }
                  }
                ]
              },
              {
                "width": 30,
                "view": {"stroke": null},
                "mark": {"type": "text", "align": "center"},
                "encoding": {
                  "y": {
                    "field": "Age",
                    "type": "ordinal",
                    "sort": ["15 - 24","25 - 34","35 - 44","45 - 54","55 - 64","65+"],
                    "axis": null
                  },
                  "text": {"field": "Age"}
                }
              },
              {
                "width": 240,
                "transform": [
                  {"filter": "datum.Gender == 'Male'"},
                  {"filter": "datum.Value == selected_measure"},
                  {
                    "calculate": "selected_measure == 'Workplace Claims' ? 'Number of Injuries' : 'Number of Fatalities'",
                    "as": "Measure"
                  }
                ],
                "layer": [
                  {
                    "mark": {"type": "bar", "size": 19},
                    "encoding": {
                      "y": {
                        "field": "Age",
                        "type": "ordinal",
                        "sort": ["15 - 24","25 - 34","35 - 44","45 - 54","55 - 64","65+"],
                        "axis": null
                      },
                      "x": {
                        "aggregate": "sum",
                        "field": "Total",
                        "title": {"expr": "selected_measure"},
                        "scale": {
                          "domain": {
                            "expr": "selected_measure == 'Workplace Claims' ? [0, 22000] : [0, 85]"
                          }
                        },
                        "axis": {"format": "d", "tickCount": 5}
                      },
                      "color": {
                        "field": "Gender",
                        "scale": {"range": ["#e377c2", "#1f77b4"]},
                        "legend": null
                      },
                      "tooltip": [
                        {"field": "Gender"},
                        {"field": "Measure"},
                        {"field": "Age", "title": "Age Group"},
                        {"field": "Total", "title": "Total", "format": ","},
                      ]
                    }
                  }
                ]
              }
            ]
          }
        ]
      };

    const spec6 = {
      "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
      "config": {
        "font": "Manrope",
        "axis": {"labelColor": "#333", "titleColor": "#333"}
      },  
      "width": 380,
      "height": 500,
      "data": {
        "url": "https://raw.githubusercontent.com/ltan0120/Final-3179/main/Chart%207%20-%20Reasons%20for%20Stopping%20Work.csv"
      },
      "params": [
        {
          "name": "StatusFilter",
          "value": "Ceased Working",
          "bind": {
            "input": "select",
            "options": ["Ceased Working", "Still Working"],
            "labels": ["Ceased Working", "Still Working"],
            "name": "Select Decision After Injury: "
          }
        }
      ],
      "transform": [
        {
          "filter": "datum.Gender == 'Male' || datum.Gender == 'Female'"
        },
        {
          "filter": "datum.Parent == StatusFilter"
        },
        {
          "calculate": "datum.Percent + '%'", 
          "as": "PercentLabel"
        }
      ],
      "mark": "bar",
      "encoding": {
        "x": {
          "field": "Gender",
          "type": "nominal",
          "axis": {"title": "Gender", "labelAngle": 0}
        },
        "y": {
          "field": "Proportion",
          "type": "quantitative",
          "stack": "zero",
          "axis": {"title": "Percentage", "format": ".0%"}
        },
        "color": {
          "field": "Reason",
          "type": "nominal",
          "scale": {
            "range": [
              "#809191", 
              "#4bacc6", 
              "#9bbb59", 
              "#f79646", 
              "#c0504d",
            ]
          },
          "legend": {"title": "Reason"}
        },
        "tooltip": [
          {"field": "Gender", "title": "Gender"},
          {"field": "Parent", "title": "Decision"},
          {"field": "Reason", "title": "Reason"},
          {"field": "PercentLabel", "title": "Percent"}
        ]
      }
    };


  vegaEmbed('#chart1', spec1, {actions: false});  
  vegaEmbed('#chart2', spec2, {actions: false});
  vegaEmbed('#chart3', spec3, {actions: false});
  vegaEmbed('#chart4', spec4, {actions: false});
  vegaEmbed('#chart5', spec5, {actions: false});
  vegaEmbed('#chart6', spec6, {actions: false});
  </script>

</body>
</html>



